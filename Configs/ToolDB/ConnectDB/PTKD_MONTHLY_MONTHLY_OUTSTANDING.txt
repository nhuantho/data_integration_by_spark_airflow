SELECT/*+ INDEX(A W_DOCUMENT_ODS_HISTORY_DW) */ A.CODE_NO , A.DATE_WID, CASE WHEN A.OVER_DUE_DAYS < 90 THEN 0x91<90DAYS0x91 ELSE 0x91>=90DAYS0x91 END DPD, A.PRINCIPAL_AMOUNT, A.DISBURST_AMOUNT, CASE WHEN L_1.ASSET_TYPE_WID = 7 THEN 0x91OTO0x91 WHEN L_1.ASSET_TYPE_WID = 15 THEN 0x91DKOTO0x91 WHEN L_1.ASSET_TYPE_WID = 17 THEN 0x91DKXM0x91 ELSE 0x91KH√ÅC0x91 END ASSET, A.CIF_CODE , FL.GENDER_NM, FL.BIRTH_DAY, C.VUNG, C.DV_HC, C.DIA_HINH, FL.INDUSTRY_NM, CASE WHEN P.LOAN_PURPOSE_NAME IS NULL THEN L_1.LOAN_PURPOSE ELSE P.LOAN_PURPOSE_NAME END LOAN_PURPOSE FROM W_DOCUMENT_ODS_HISTORY A JOIN W_LOAN_DTL_F L_1 ON L_1.LOAN_CODE = A.CODE_NO LEFT JOIN (SELECT S.SHOP_WID, M.OPEN_DT VUNG, M.DV_HC, M.DIA_HINH, S.SHOP_CODE,S.VALID_FM_DT ,S.VALID_TO_DT FROM F88DWH.W_SHOP_D S LEFT JOIN F88DWH.W_AREA_MANAGER_D M ON TRIM(S.SHOP_CODE) = TRIM(M.SHOP_ID)) C ON A.OFFICE_CODE = C.SHOP_CODE AND C.VALID_FM_DT <= TO_DATE(:LAST_DAY_OF_MONTH,0x91YYYYMMDD0x91) AND TO_DATE(:LAST_DAY_OF_MONTH,0x91YYYYMMDD0x91) < C.VALID_TO_DT LEFT JOIN (SELECT DISTINCT CUSTOMER_CODE, GENDER_NM, BIRTH_DAY, INDUSTRY_NM FROM MINHNH.W_FIRST_LOAN_CONTRACT_V ) FL ON A.CIF_CODE = FL.CUSTOMER_CODE LEFT JOIN (SELECT L.LOAN_WID, L.LOAN_PURPOSE_NAME, COUNT(L.LOAN_WID) FROM F88DWH.W_LOAN_CUSTOMER_F L JOIN (SELECT LOAN_WID, MAX(INTEGRATION_ID) MAX_ID FROM F88DWH.W_LOAN_CUSTOMER_F GROUP BY LOAN_WID) T ON L.LOAN_WID = T.LOAN_WID AND L.INTEGRATION_ID = T.MAX_ID GROUP BY L.LOAN_WID, L.LOAN_PURPOSE_NAME) P ON L_1.LOAN_WID = P.LOAN_WID WHERE 1 = 1 AND A.YEAR_NUM = :YEAR1 AND A.MONTH_NUM = :MONTH1 AND A.DATE_WID = :LAST_DAY_OF_MONTH AND A.LOAN_STATUS IN (300,603) AND A.IS_BAD_DEBT <> 1 AND (NVL(L_1.FUND_NAME,0x91F88 FUND0x91) <> 0x91CIMB FUND0x91 OR A.IS_BUY_DEBT = 1)